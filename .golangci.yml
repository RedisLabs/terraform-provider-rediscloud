# golangci-lint configuration for terraform-provider-rediscloud
# https://golangci-lint.run/usage/configuration/
version: "2"

run:
  timeout: 10m
  modules-download-mode: readonly

linters:
  default: none
  enable:
    # Default linters
    - errcheck      # Check for unchecked errors
    - govet         # Report suspicious constructs
    - staticcheck   # Static analysis

    # Additional recommended linters
    - bodyclose     # Check HTTP response body is closed
    - durationcheck # Check for duration multiplication issues
    - errorlint     # Find code that will cause problems with Go 1.13 error wrapping
    - misspell      # Find commonly misspelled English words
    - nilerr        # Find code that returns nil even if error is not nil
    - noctx         # Find HTTP requests without context.Context
    - unconvert     # Remove unnecessary type conversions
    - unparam       # Find unused function parameters
    - wastedassign  # Find wasted assignment statements

  settings:
    errcheck:
      # Don't report type assertions - Terraform providers always pass correct client type
      check-type-assertions: false

    govet:
      # Enable all analyzers except noisy ones
      enable-all: true
      disable:
        - fieldalignment  # Too noisy for existing codebase
        - shadow          # if err := d.Set(...); err != nil pattern is idiomatic in Terraform providers

    misspell:
      locale: UK
      # Words to ignore (API terms that must match external systems)
      extra-words:
        - typo: "organization"
          correction: "organization"
        - typo: "initialized"
          correction: "initialized"
        - typo: "center"
          correction: "center"

    staticcheck:
      # Enable all checks except noisy ones
      checks:
        - "all"
        - "-QF1011"  # Type can be inferred - style preference
        - "-S1007"   # Raw strings in regexp - style preference, both forms work
        - "-ST1000"  # Package comments - low value for internal packages
        - "-ST1003"  # Naming conventions (Acl vs ACL, Id vs ID) - would require massive refactor
        - "-ST1020"  # Comment format on exported functions - pedantic
        - "-ST1022"  # Comment format on exported vars/consts - pedantic
        - "-ST1023"  # Redundant type in var declaration - style preference

  exclusions:
    # Maximum count of issues with the same text (0 = unlimited)
    max-same-issues: 0

    rules:
      # Ignore some checks in test files
      - path: _test\.go
        linters:
          - unparam  # Test functions often have unused parameters for consistency

      - path: _test\.go
        text: "fieldalignment:"

formatters:
  enable:
    - gofmt         # Check code is formatted
    - goimports     # Check imports are organised

  settings:
    goimports:
      # Put local imports after 3rd-party packages
      local-prefixes:
        - github.com/RedisLabs/terraform-provider-rediscloud
